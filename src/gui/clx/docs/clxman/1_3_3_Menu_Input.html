<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- This file is automatically generated, do not edit -->

<HTML LANG='en'>
  <HEAD>
    <TITLE>1.3.3 Menu Input</TITLE>
    <LINK HREF='mailto:gilbert@ma2s2.mathematik.uni-karlsruhe.de' REV='made'>
    <LINK HREF='1_3_4_The_Main_Program.html' REL='Next'>
    <LINK HREF='1_3_2_Displaying_the_Menu.html' REL='Previous'>
    <LINK HREF='index.html' REL='Start'>
    <LINK HREF='contents.html' REL='Contents'>
    <LINK HREF='the_index.html' REL='Index'>
    <LINK HREF='Glossary.html' REL='Glossary'>
    <LINK HREF='Front_matter.html' REL='Copyright'>
  <BODY BGCOLOR='#FFFFFF'>
    <A HREF='1_3_4_The_Main_Program.html'>Next</A> <A
     HREF='1_3_2_Displaying_the_Menu.html'>Prev</A> <A
     HREF='1_3_A_Quick_Tour_of_CLX.html'>Up</A> 
    <HR>
    <H1><FONT FACE='helvetica' COLOR='#004000'>1.3.3 Menu Input</FONT></H1>
     
    <P>
      Now that a menu can be displayed, the sample client program must define 
      how the menu will process user input. The <CODE>menu-choose</CODE> 
      function (shown in the following example) has the classic structure of 
      an X client program. First, do some initialization (for example, 
      present the menu at a given location). Then, enter an input event loop. 
      Read an input event, process it, and repeat the loop until a 
      termination event is received. The <A
       HREF='12_3_Processing_Events.html#event-case'><B>event-case</B></A> 
      macro continues reading an event from the menu window&#39;s display 
      object until one of its clauses returns non-<B>nil</B>. These clauses 
      specify the action to be taken for each event type and also bind values 
      from the event report to local variables, such as the <B>event-window
      </B> receiving the event. Notice that the <B>:force-output-p</B> option 
      is enabled, causing <A HREF='12_3_Processing_Events.html#event-case'><B>
      event-case</B></A> to begin by sending any client requests which CLX 
      has not yet output to the server. To improve performance, CLX quietly 
      queues up requests and periodically sends them off in a batch. However, 
      in an interactive feedback loop such as this, it is important to keep 
      the display crisply up-to-date.
    <PRE>
(defun menu-choose (menu x y)
  ;; Display the menu so that first item is at x,y.
  (menu-present menu x y)

  (let ((items (menu-item-alist menu))
        (mw    (menu-window menu))
        selected-item)

    ;; Event processing loop
    (do () (selected-item)
      (EVENT-CASE ((DRAWABLE-DISPLAY mw) :force-output-p t)
                  (:exposure
                   (count)
                   ;; Discard all but final :exposure then display the menu
                   (when (zerop count) (menu-refresh menu))
                   t)

                  (:button-release
                   (event-window)
                   ;;Select an item
                   (setf selected-item (second (assoc event-window items)))
                   t)

                  (:enter-notify
                   (window)
                   ;;Highlight an item
                   (menu-highlight-item menu (find window items :key #&#39;first))
                   t)

                  (:leave-notify
                   (window kind)
                   (if (eql mw window)
                       ;; Quit if pointer moved out of main menu window
                       (setf selected-item (when (eq kind :ancestor) :none))
                     ;; Otherwise, unhighlight the item window left
                     (menu-unhighlight-item menu (find window items :key #&#39;first)))
                   t)

                  (otherwise
                   ()
                   ;;Ignore and discard any other event
                   t)))

    ;; Erase the menu
    (UNMAP-WINDOW mw)

    ;; Return selected item string, if any
    (unless (eq selected-item :none) selected-item)))
        </PRE>
     
    <P>
      The event loop in <CODE>menu-choose</CODE> demonstrates an idiom used 
      in all X programs: the contents of a window are displayed (in this 
      case, by calling <CODE>menu-refresh</CODE>) only when an <A
       HREF='12_12_4_Exposure_Events.html#:exposure'><B>:exposure</B></A> 
      event is received, signaling that the server has actually made the 
      window <I>viewable</I>. The handling of <A
       HREF='12_12_4_Exposure_Events.html#:exposure'><B>:exposure</B></A> in 
      <CODE>menu-choose</CODE> also implements a little trick for improving 
      efficiency. In general, when a window is exposed after being previously 
      obscured (perhaps only partially), the server is free to send several <A
       HREF='12_12_4_Exposure_Events.html#:exposure'><B>:exposure</B></A> 
      events, one for each rectangular tile of the exposed region. For small 
      windows like this menu, it is not worth the trouble to redraw the image 
      one tile at a time. So the code above just ignores all but the last 
      tile exposure and redraws everything in one call to <CODE>menu-refresh
      </CODE>.
    
    <HR>
    <A HREF='1_3_4_The_Main_Program.html'>Next</A> <A
     HREF='1_3_2_Displaying_the_Menu.html'>Prev</A> <A
     HREF='1_3_A_Quick_Tour_of_CLX.html'>Up</A> 
    <HR>
    <A HREF='Front_matter.html'>&#169; 1988, 1989 Texas Instruments 
    Incorporated</A>
    <BR>
    Conversion to HTML made by <A
     HREF='mailto:gilbert@ma2s2.mathematik.uni-karlsruhe.de' LANG='de'>
    Gilbert Baumann</A>.
    <BR>
    Last build: Tue Dec 16 23:30:42 1997
