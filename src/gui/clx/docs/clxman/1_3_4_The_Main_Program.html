<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- This file is automatically generated, do not edit -->

<HTML LANG='en'>
  <HEAD>
    <TITLE>1.3.4 The Main Program</TITLE>
    <LINK HREF='mailto:gilbert@ma2s2.mathematik.uni-karlsruhe.de' REV='made'>
    <LINK HREF='1_3_5_Debugging_With_CLX.html' REL='Next'>
    <LINK HREF='1_3_3_Menu_Input.html' REL='Previous'>
    <LINK HREF='index.html' REL='Start'>
    <LINK HREF='contents.html' REL='Contents'>
    <LINK HREF='the_index.html' REL='Index'>
    <LINK HREF='Glossary.html' REL='Glossary'>
    <LINK HREF='Front_matter.html' REL='Copyright'>
  <BODY BGCOLOR='#FFFFFF'>
    <A HREF='1_3_5_Debugging_With_CLX.html'>Next</A> <A
     HREF='1_3_3_Menu_Input.html'>Prev</A> <A
     HREF='1_3_A_Quick_Tour_of_CLX.html'>Up</A> 
    <HR>
    <H1><FONT FACE='helvetica' COLOR='#004000'>1.3.4 The Main Program</FONT>
    </H1>
     
    <P>
      After all the preceding build-up and the other functions referenced 
      (but not shown here) have been implemented, the code for the main 
      client program is very small.
    <PRE>
(defun just-say-lisp (host &#38;optional (font-name &#34;fg-16&#34;))
  (let* ((display   (OPEN-DISPLAY host))
         (screen    (first (DISPLAY-ROOTS display)))
         (fg-color  (SCREEN-BLACK-PIXEL screen))
         (bg-color  (SCREEN-WHITE-PIXEL screen))
         (nice-font (OPEN-FONT display font-name))

         ;; Create a menu as a child of the root window.
         (a-menu       (create-menu (SCREEN-ROOT screen)
                                    fg-color bg-color nice-font)))

    (setf (menu-title a-menu) &#34;Please pick your favorite language:&#34;)
    (menu-set-item-list a-menu &#34;Fortran&#34; &#34;APL&#34; &#34;Forth&#34; &#34;Lisp&#34;)

    ;; Bedevil the user until he picks a nice programming language
    (unwind-protect
        (loop
          ;; Determine the current root window position of the pointer
          (multiple-value-bind (x y) (QUERY-POINTER (SCREEN-ROOT screen))

            (let ((choice (menu-choose a-menu x y)))
              (when (string-equal &#34;Lisp&#34; choice)
                (return)))))

      (CLOSE-DISPLAY display))))
        </PRE>
     
    <P>
      Note that the main program event loop lies in the body of an <B>
      unwind-protect</B> form. This is a good programming technique because, 
      without this protection, an unexpected error could cause the program to 
      terminate without freeing the <I>server resources</I> it has created. 
      Server resources are CLX objects which refer to objects actually stored 
      on the X server. Examples of these are <A
       HREF='1_6_Data_Types.html#window'><B>window</B></A>, <A
       HREF='1_6_Data_Types.html#font'><B>font</B></A>, <A
       HREF='1_6_Data_Types.html#pixmap'><B>pixmap</B></A>, <A
       HREF='1_6_Data_Types.html#cursor'><B>cursor</B></A>, <A
       HREF='1_6_Data_Types.html#colormap'><B>colormap</B></A>, and <A
       HREF='1_6_Data_Types.html#gcontext'><B>gcontext</B></A> objects. These 
      server resources are created and destroyed by user requests. Server 
      resources created by a client are also destroyed when its display 
      connection is closed. If client resources are repeatedly created 
      without being destroyed, then the server will eventually run out of 
      memory and fail.
    <P>
      Most server resources are potentially sharable between applications. In 
      fact, windows are manipulated explicitly by window manager programs. 
      Fonts and cursors are typically shared automatically since the X server 
      loads and unloads font storage as needed. <A
       HREF='1_6_Data_Types.html#gcontext'><B>gcontext</B></A> objects are 
      not ordinarily shared between client applications.
    
    <HR>
    <A HREF='1_3_5_Debugging_With_CLX.html'>Next</A> <A
     HREF='1_3_3_Menu_Input.html'>Prev</A> <A
     HREF='1_3_A_Quick_Tour_of_CLX.html'>Up</A> 
    <HR>
    <A HREF='Front_matter.html'>&#169; 1988, 1989 Texas Instruments 
    Incorporated</A>
    <BR>
    Conversion to HTML made by <A
     HREF='mailto:gilbert@ma2s2.mathematik.uni-karlsruhe.de' LANG='de'>
    Gilbert Baumann</A>.
    <BR>
    Last build: Tue Dec 16 23:30:42 1997
