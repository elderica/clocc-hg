<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- This file is automatically generated, do not edit -->

<HTML LANG='en'>
  <HEAD>
    <TITLE>6.7 Drawing Text</TITLE>
    <LINK HREF='mailto:gilbert@ma2s2.mathematik.uni-karlsruhe.de' REV='made'>
    <LINK HREF='7_Images.html' REL='Next'>
    <LINK HREF='6_6_Drawing_Arcs.html' REL='Previous'>
    <LINK HREF='index.html' REL='Start'>
    <LINK HREF='contents.html' REL='Contents'>
    <LINK HREF='the_index.html' REL='Index'>
    <LINK HREF='Glossary.html' REL='Glossary'>
    <LINK HREF='Front_matter.html' REL='Copyright'>
  <BODY BGCOLOR='#FFFFFF'>
    <A HREF='7_Images.html'>Next</A> <A HREF='6_6_Drawing_Arcs.html'>Prev</A> 
    <A HREF='6_Graphic_Operations.html'>Up</A> 
    <HR>
    <H1><FONT FACE='helvetica' COLOR='#004000'>6.7 Drawing Text</FONT></H1>
     
    <P>
      CLX provides functions for drawing text using text fonts provided by 
      the X server. An X font is array of character bit maps indexed by 
      integer codes. See Section 8 for a complete discussion of the CLX 
      functions used to manage fonts and characters.
    <P>
      Since Common Lisp programs typically represent text as sequences of 
      characters (that is, strings), CLX text functions must be prepared to 
      convert a Common Lisp character into the integer code used to index the 
      appropriate character bitmap in a given font. The <B>:translate</B> 
      argument to a text function is a function which performs this 
      conversion. The default <B>:translate</B> function handles all 
      characters that satisfy <B>graphic-char-p</B> by converting each 
      character into its ASCII code. Note that the assumption made by the 
      default <B>:translate</B> function--that is, that an X font indexes 
      bitmaps by ASCII codes--is often valid, but other encodings are 
      possible. In general, a <B>:translate</B> function can perform complex 
      transformations. It can be used to convert non-character input, to 
      handle non-ASCII character encodings, and to change the fonts used to 
      access character bitmaps. The complete behavior of a <B>:translate</B> 
      function is given below by describing a prototypical <A
       HREF='6_7_Drawing_Text.html#translate-function'><B>translate-function
      </B></A>.
    <P>
      CLX offers two different ways to draw text--filled text and block text. 
      The <A HREF='6_7_Drawing_Text.html#draw-glyph'><B>draw-glyph</B></A> 
      and <A HREF='6_7_Drawing_Text.html#draw-glyphs'><B>draw-glyphs</B></A> 
      functions create filled text, in which each character image is treated 
      as an area to be filled according to the fill-style of the given 
      graphics context, without otherwise disturbing the surrounding 
      background. In addition, filled text sends a complex type of server 
      request which allows a series of font indices, font changes, and 
      horizontal position changes to be compiled into a single request. 
      Filled text functions use the following graphics context attributes: 
      background, clip-mask, clip-x-origin, clip-y-origin, fill-style, font, 
      foreground, function, plane-mask, stipple, subwindow-mode, tile, 
      ts-x-origin, ts-y-origin.
    <P>
      Block text is a rendering style commonly used by display terminals, in 
      which each character image appears in the foreground pixel inside a 
      rectangular character cell drawn in the graphics context background 
      pixel. The <A HREF='6_7_Drawing_Text.html#draw-image-glyph'><B>
      draw-image-glyph</B></A> and <A
       HREF='6_7_Drawing_Text.html#draw-image-glyphs'><B>draw-image-glyphs</B>
      </A> functions create block text. Block text functions use the 
      following graphics context attributes: background, clip-mask, 
      clip-x-origin, clip-y-origin, font, foreground, plane-mask, stipple, 
      subwindow-mode, tile, ts-x-origin, ts-y-origin.
    <DIV>
      <HR>
      <A NAME='draw-glyph'></A>
      <TABLE>
        <TR>
          <TD VALIGN='TOP' ALIGN='LEFT'><B>draw-glyph</B>
          <TD WIDTH='100%' VALIGN='TOP' ALIGN='LEFT'><I>drawable gcontext x y 
            element</I> &#38;key <B>:translate :width</B> (<B>:size :default
            </B>)
          <TD VALIGN='TOP' ALIGN='RIGHT'>Function
      </TABLE>
      <TABLE>
        <TR>
          <TD>&#160;&#160;&#160;&#160;&#160;
          <TD>
            <DL>
              <DT>
                <I>drawable</I>
              <DD>
                The destination <A HREF='1_6_Data_Types.html#drawable'><B>
                drawable</B></A>.
              <DT>
                <I>gcontext</I>
              <DD>
                The graphics context for drawing text.
              <DT>
                <I>x</I>, <I>y</I>
              <DD>
                The left baseline position for the character drawn.
              <DT>
                <I>element</I>
              <DD>
                A character or other object to be translated into a font 
                index.
              <DT>
                <B>:translate</B>
              <DD>
                A function to translate text to font indexes. Default is <B>
                #&#39;translate-default</B>.
              <DT>
                <B>:width</B>
              <DD>
                The total pixel width of the character actually drawn, if 
                known.
              <DT>
                <B>:size</B>
              <DD>
                Specifies the element size of the destination buffer given to 
                <B>:translate</B> (8, 16, or <B>:default</B>).
            </DL>
            <P>
              Draws a single character of filled text represented by the 
              given <I>element</I>. The given <I>x</I> and <I>y</I> specify 
              the left baseline position for the character. The first return 
              value is true if the character is successfully translated and 
              drawn, or <B>nil</B> if the <B>:translate</B> function did not 
              translate it. The second return value gives the total pixel 
              width of the character actually drawn, if known.
            <P>
              Specifying a <B>:width</B> is a hint to improve performance. 
              The <B>:width</B> is assumed to be the total pixel width of the 
              character actually drawn. Specifying <B>:width</B> permits 
              appending the output of subsequent calls to the same protocol 
              request, provided <I>gcontext</I> has not been modified in the 
              interim. If <B>:width</B> is not specified, appending of 
              subsequent output might not occur (unless <B>:translate</B> 
              returns the character width).
            <P>
              The <B>:size</B> specifies the element size of the destination 
              buffer given to <B>:translate</B> (either 8, 16, or <B>:default
              </B>). If <B>:default</B> is specified, the size is based on 
              the current font, if known; otherwise, 16 is used.
            <DL>
              <DT>
                <I>output-p</I>
              <DD>
                Type <A HREF='1_6_Data_Types.html#boolean'><B>boolean</B></A>.
              <DT>
                <I>width</I>
              <DD>
                Type <A HREF='1_6_Data_Types.html#int32'><B>int32</B></A> or 
                <B>null</B>.
            </DL>
      </TABLE>
    </DIV>
     
    <DIV>
      <HR>
      <A NAME='draw-glyphs'></A>
      <TABLE>
        <TR>
          <TD VALIGN='TOP' ALIGN='LEFT'><B>draw-glyphs</B>
          <TD WIDTH='100%' VALIGN='TOP' ALIGN='LEFT'><I>drawable gcontext x y 
            sequence</I> &#38;key (<B>:start</B> 0) <B>:end :translate :width
            </B> (<B>:size :default</B>)
          <TD VALIGN='TOP' ALIGN='RIGHT'>Function
      </TABLE>
      <TABLE>
        <TR>
          <TD>&#160;&#160;&#160;&#160;&#160;
          <TD>
            <DL>
              <DT>
                <I>drawable</I>
              <DD>
                The destination <A HREF='1_6_Data_Types.html#drawable'><B>
                drawable</B></A>.
              <DT>
                <I>gcontext</I>
              <DD>
                The graphics context for drawing text.
              <DT>
                <I>x</I>, <I>y</I>
              <DD>
                The left baseline position for the character drawn.
              <DT>
                <I>sequence</I>
              <DD>
                A sequence of characters or other objects to be translated 
                into font indexes.
              <DT>
                <B>:start</B>, <B>:end</B>
              <DD>
                Start and end indexes defining the elements to draw.
              <DT>
                <B>:translate</B>
              <DD>
                A function to translate text to font indexes. Default is <B>
                #&#39;translate-default</B>.
              <DT>
                <B>:width</B>
              <DD>
                The total total pixel width of the character actually drawn, 
                if known.
              <DT>
                <B>:size</B>
              <DD>
                The element size of the destination buffer given to <B>
                :translate</B> (8, 16, or <B>:default</B>).
            </DL>
            <P>
              Draws the filled text characters represented by the given 
              sequence. <B>:start</B> and <B>:end</B> define the elements of 
              the sequence which are drawn. The given <I>x</I> and <I>y</I> 
              specify the left baseline position for the first character. The 
              first return value is <B>nil</B> if all characters are 
              successfully translated and drawn; otherwise, the index of the 
              first untranslated sequence element is returned. The second 
              return value gives the total pixel width of the characters 
              actually drawn, if known.
            <P>
              Specifying a <B>:width</B> is a hint to improve performance. 
              The <B>:width</B> is assumed to be the total pixel width of the 
              character sequence actually drawn. Specifying <B>:width</B> 
              permits appending the output of subsequent calls to the same 
              protocol request, provided <I>gcontext</I> has not been 
              modified in the interim. If <B>:width</B> is not specified, 
              appending of subsequent output might not occur (unless <B>
              :translate</B> returns the character width).
            <P>
              The <B>:size</B> specifies the element size of the destination 
              buffer given to<B>:translate</B> (either 8, 16, or <B>:default
              </B>). If <B>:default</B> is specified, the size is based on 
              the current font, if known; otherwise, 16 is used.
            <DL>
              <DT>
                <I>new-start</I>
              <DD>
                Type <A HREF='1_6_Data_Types.html#array-index'><B>array-index
                </B></A> or <B>null</B>.
              <DT>
                <I>width</I>
              <DD>
                Type <A HREF='1_6_Data_Types.html#int32'><B>int32</B></A> or 
                <B>null</B>.
            </DL>
      </TABLE>
    </DIV>
     
    <DIV>
      <HR>
      <A NAME='draw-image-glyph'></A>
      <TABLE>
        <TR>
          <TD VALIGN='TOP' ALIGN='LEFT'><B>draw-image-glyph</B>
          <TD WIDTH='100%' VALIGN='TOP' ALIGN='LEFT'><I>drawable gcontext x y 
            element</I> &#38;key <B>:translate :width</B> (<B>:size :default
            </B>)
          <TD VALIGN='TOP' ALIGN='RIGHT'>Function
      </TABLE>
      <TABLE>
        <TR>
          <TD>&#160;&#160;&#160;&#160;&#160;
          <TD>
            <DL>
              <DT>
                <I>drawable</I>
              <DD>
                The destination <A HREF='1_6_Data_Types.html#drawable'><B>
                drawable</B></A>.
              <DT>
                <I>gcontext</I>
              <DD>
                The graphics context for drawing text.
              <DT>
                <I>x</I>, <I>y</I>
              <DD>
                The left baseline position for the character drawn.
              <DT>
                <I>element</I>
              <DD>
                A character or other object to be translated into a font 
                index.
              <DT>
                <B>:translate</B>
              <DD>
                A function to translate text to font indexes. Default is <B>
                #&#39;translate-default</B>.
              <DT>
                <B>:width</B>
              <DD>
                The total pixel width of the character actually drawn, if 
                known.
              <DT>
                <B>:size</B>
              <DD>
                Specifies the element size of the destination buffer given to 
                <B>:translate</B> (8, 16, or <B>:default</B>).
            </DL>
            <P>
              Draws a single character of block text represented by the given 
              <I>element</I>. The given <I>x</I> and <I>y</I> specify the 
              left baseline position for the character. The first return 
              value is true if the character is successfully translated and 
              drawn, or <B>nil</B> if the <B>:translate</B> function did not 
              translate it. The <B>:translate</B> function is allowed to 
              return an initial font change. The second return value gives 
              the total pixel width of the character actually drawn, if known.
            <P>
              The <B>:translate</B> function may not return a horizontal 
              position change, since <A
               HREF='6_7_Drawing_Text.html#draw-image-glyph'><B>
              draw-image-glyph</B></A> does not generate complex output 
              requests.
            <P>
              Specifying a <B>:width</B> is a hint to improve performance. 
              The <B>:width</B> is assumed to be the total pixel width of the 
              character actually drawn. Specifying <B>:width</B> permits 
              appending the output of subsequent calls to the same protocol 
              request, provided <I>gcontext</I> has not been modified in the 
              interim. If <B>:width</B> is not specified, appending of 
              subsequent output might not occur (unless <B>:translate</B> 
              returns the character width).
            <P>
              The <B>:size</B> specifies the element size of the destination 
              buffer given to <B>:translate</B> (either 8, 16, or <B>:default
              </B>). If <B>:default</B> is specified, the size is based on 
              the current font, if known; otherwise, 16 is used.
            <DL>
              <DT>
                <I>output-p</I>
              <DD>
                Type <A HREF='1_6_Data_Types.html#boolean'><B>boolean</B></A>.
              <DT>
                <I>width</I>
              <DD>
                Type <A HREF='1_6_Data_Types.html#int32'><B>int32</B></A> or 
                <B>null</B>.
            </DL>
      </TABLE>
    </DIV>
     
    <DIV>
      <HR>
      <A NAME='draw-image-glyphs'></A>
      <TABLE>
        <TR>
          <TD VALIGN='TOP' ALIGN='LEFT'><B>draw-image-glyphs</B>
          <TD WIDTH='100%' VALIGN='TOP' ALIGN='LEFT'><I>drawable gcontext x y 
            sequence</I> &#38;key (<B>:start</B> 0) <B>:end</B> <B>:translate 
            :width</B> (<B>:size :default</B>)
          <TD VALIGN='TOP' ALIGN='RIGHT'>Function
      </TABLE>
      <TABLE>
        <TR>
          <TD>&#160;&#160;&#160;&#160;&#160;
          <TD>
            <DL>
              <DT>
                <I>drawable</I>
              <DD>
                The destination <A HREF='1_6_Data_Types.html#drawable'><B>
                drawable</B></A>.
              <DT>
                <I>x</I>, <I>y</I>
              <DD>
                The left baseline position for the character drawn.
              <DT>
                <I>gcontext</I>
              <DD>
                The graphics context for drawing text.
              <DT>
                <I>sequence</I>
              <DD>
                A sequence of characters or other objects to be translated 
                into font indexes.
              <DT>
                <B>:start</B>, <B>:end</B>
              <DD>
                Start and end indexes defining the elements to draw.
              <DT>
                <B>:translate</B>
              <DD>
                A function to translate text to font indexes. Default is <B>
                #&#39;translate-default</B>.
              <DT>
                <B>:width</B>
              <DD>
                The total total pixel width of the character actually drawn, 
                if known.
              <DT>
                <B>:size</B>
              <DD>
                The element size of the destination buffer given to <B>
                :translate</B> (8, 16, or <B>:default</B>).
            </DL>
            <P>
              Draws the block text characters represented by the given <B>
              sequence</B>. <B>:start</B> and <B>:end</B> define the elements 
              of the <I>sequence</I> which are drawn. The given <I>x</I> and 
              <I>y</I> specify the left baseline position for the first 
              character. The first return value is <B>nil</B> if all 
              characters are successfully translated and drawn; otherwise, 
              the index of the first untranslated sequence element is 
              returned. The <B>:translate</B> function is allowed to return 
              an initial font change. The second return value gives the total 
              pixel width of the characters actually drawn, if known.
            <P>
              The <B>:translate</B> function may not return a horizontal 
              position change, since <A
               HREF='6_7_Drawing_Text.html#draw-image-glyphs'><B>
              draw-image-glyphs</B></A> does not generate complex output 
              requests.
            <P>
              Specifying a <B>:width</B> is a hint to improve performance. 
              The <B>:width</B> is assumed to be the total pixel width of the 
              character sequence actually drawn. Specifying <B>:width</B> 
              permits appending the output of subsequent calls to the same 
              protocol request, provided <I>gcontext</I> has not been 
              modified in the interim. If <B>:width</B> is not specified, 
              appending of subsequent output might not occur (unless <B>
              :translate</B> returns the character width).
            <P>
              The <B>:size</B> specifies the element size of the destination 
              buffer given to <B>:translate</B> (either 8, 16, or <B>:default
              </B>). If <B>:default</B> is specified, the size will be based 
              on the current font, if known; otherwise, 16 is used.
            <DL>
              <DT>
                <I>new-start</I>
              <DD>
                Type <A HREF='1_6_Data_Types.html#array-index'><B>array-index
                </B></A> or <B>null</B>.
              <DT>
                <I>width</I>
              <DD>
                Type <A HREF='1_6_Data_Types.html#int32'><B>int32</B></A> or 
                <B>null</B>.
            </DL>
      </TABLE>
    </DIV>
     
    <DIV>
      <HR>
      <A NAME='translate-function'></A>
      <TABLE>
        <TR>
          <TD VALIGN='TOP' ALIGN='LEFT'><B>translate-function</B>
          <TD WIDTH='100%' VALIGN='TOP' ALIGN='LEFT'><I>source source-start 
            source-end font destination destination-start</I>
          <TD VALIGN='TOP' ALIGN='RIGHT'>Function
      </TABLE>
      <TABLE>
        <TR>
          <TD>&#160;&#160;&#160;&#160;&#160;
          <TD>
            <DL>
              <DT>
                <I>source</I>
              <DD>
                A sequence of characters or other objects to be translated.
              <DT>
                <I>source-start</I>
              <DD>
                An array-index specifying the first <I>source</I> element to 
                be translated.
              <DT>
                <I>source-end</I>
              <DD>
                An array-index specifying the end of the <I>source</I> 
                subsequence to be translated.
              <DT>
                <I>font</I>
              <DD>
                The font indexed by translated <I>source</I> elements.
              <DT>
                <I>destination</I>
              <DD>
                A vector where translated <I>source</I> elements are stored.
              <DT>
                <I>destination-start</I>
              <DD>
                An array-index specifying the position to begin storing 
                translated <I>source</I> elements.
            </DL>
            <P>
              A function used as the <B>:translate</B> argument for text 
              functions. Converts elements of the <I>source</I> (sub)sequence 
              into font indexes for the given <I>font</I> and stores them 
              into the <I>destination</I> vector.
            <P>
              The <I>destination</I> vector is created automatically by CLX. 
              <I>destination</I> is guaranteed to have room for (- <I>
              source-end source-star</I>t) integer elements, starting at <I>
              destination-start</I>. Elements of <I>destination</I> can be 
              either <A HREF='1_6_Data_Types.html#card8'><B>card8</B></A> or 
              <A HREF='1_6_Data_Types.html#card16'><B>card16</B></A> 
              integers, depending on the context. <I>font</I> is the current 
              font, if known, or <B>nil</B> otherwise. Starting with the 
              element at <I>source-start</I>, <A
               HREF='6_7_Drawing_Text.html#translate-function'><B>
              translate-function</B></A> should translate as many elements of 
              <I>source</I> as possible (up to the <I>source-end</I> element) 
              into indexes in the current <I>font</I>, and store them into <I>
              destination</I>. The first return value should be the source 
              index of the first untranslated element.
            <P>
              The second return value indicates the changes which should be 
              made to the current text output request before translating the 
              remaining <I>source</I> elements. If no further elements need 
              to be translated, the second return value should be <B>nil</B>. 
              If a horizontal motion is required before further translation, 
              the second return value should be the change in x position. If 
              a font change is required for further translation, the second 
              return value should be the new font.
            <P>
              If known, the pixel width of the translated text can be 
              returned as the third value; this can allow for appending of 
              subsequent output to the same protocol request, if no overall 
              width has been specified at the higher level.
            <DL>
              <DT>
                <I>first-not-done</I>
              <DD>
                Type <A HREF='1_6_Data_Types.html#array-index'><B>array-index
                </B></A>.
              <DT>
                <I>to-continue</I>
              <DD>
                Type <A HREF='1_6_Data_Types.html#int16'><B>int16</B></A>, <A
                 HREF='1_6_Data_Types.html#font'><B>font</B></A>, or <B>null
                </B>.
              <DT>
                <I>current-width</I>
              <DD>
                Type <A HREF='1_6_Data_Types.html#int32'><B>int32</B></A> or 
                <B>null</B>.
            </DL>
      </TABLE>
    </DIV>
     
    <HR>
    <A HREF='7_Images.html'>Next</A> <A HREF='6_6_Drawing_Arcs.html'>Prev</A> 
    <A HREF='6_Graphic_Operations.html'>Up</A> 
    <HR>
    <A HREF='Front_matter.html'>&#169; 1988, 1989 Texas Instruments 
    Incorporated</A>
    <BR>
    Conversion to HTML made by <A
     HREF='mailto:gilbert@ma2s2.mathematik.uni-karlsruhe.de' LANG='de'>
    Gilbert Baumann</A>.
    <BR>
    Last build: Tue Dec 16 23:30:42 1997
