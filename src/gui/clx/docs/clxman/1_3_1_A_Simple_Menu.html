<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- This file is automatically generated, do not edit -->

<HTML LANG='en'>
  <HEAD>
    <TITLE>1.3.1 A Simple Menu</TITLE>
    <LINK HREF='mailto:gilbert@ma2s2.mathematik.uni-karlsruhe.de' REV='made'>
    <LINK HREF='1_3_2_Displaying_the_Menu.html' REL='Next'>
    <LINK HREF='1_3_A_Quick_Tour_of_CLX.html' REL='Previous'>
    <LINK HREF='index.html' REL='Start'>
    <LINK HREF='contents.html' REL='Contents'>
    <LINK HREF='the_index.html' REL='Index'>
    <LINK HREF='Glossary.html' REL='Glossary'>
    <LINK HREF='Front_matter.html' REL='Copyright'>
  <BODY BGCOLOR='#FFFFFF'>
    <A HREF='1_3_2_Displaying_the_Menu.html'>Next</A> <A
     HREF='1_3_A_Quick_Tour_of_CLX.html'>Prev</A> <A
     HREF='1_3_A_Quick_Tour_of_CLX.html'>Up</A> 
    <HR>
    <H1><FONT FACE='helvetica' COLOR='#004000'>1.3.1 A Simple Menu</FONT></H1>
     
    <P>
      The example client program creates and displays a simple pop-up menu 
      consisting of a column of strings--a title string followed by 
      selectable menu item strings. The implementation uses one window to 
      represent the entire menu, plus a set of subwindows, one for each menu 
      item. Here is the definition of a structure which represents such a 
      menu.
    <PRE>
(defstruct (menu)
   &#34;A simple menu of text strings.&#34;
   (title &#34;Choose an item:&#34;)
   item-alist                   ;((item-window item-string))
   window
   gcontext
   width
   title-width
   item-width
   item-height
   (geometry-changed-p t))      ;nil if unchanged since displayed
        </PRE>
     
    <P>
      The <CODE>window</CODE> slot will contain the <A
       HREF='1_6_Data_Types.html#window'><B>window</B></A> object that 
      represents the menu. The <CODE>item-</CODE> <CODE>alist</CODE> 
      represents the relationship between the menu items and their associated 
      subwindows. Each entry in <CODE>item-alist</CODE> is a list whose first 
      element is a (sub)window object and whose second element is the 
      corresponding item string. A <A HREF='1_6_Data_Types.html#window'><B>
      window</B></A> object is an instance of a CLX-defined data type which 
      represents X windows. A <A HREF='1_6_Data_Types.html#window'><B>window
      </B></A> object actually carries two pieces of information: an X window 
      ID integer and a <A HREF='1_6_Data_Types.html#display'><B>display</B>
      </A> object. A <A HREF='1_6_Data_Types.html#display'><B>display</B></A> 
      is another CLX-defined data type that represents a connection to a 
      specific X display server. The <CODE>gcontext</CODE> slot contains an 
      instance of a CLX data type known as a <I>graphics</I> <I>context</I>. 
      A graphics context is a set of display attribute values, such as 
      foreground color, fill style, line style, text font, and so forth. Each 
      X graphics request (and hence each CLX graphics function call) must 
      supply a graphics context to use in displaying the request. The 
      menu&#39;s <CODE>gcontext</CODE> will thus hold all of the attribute 
      values used during menu display.
    <P>
      The first thing to do is make an instance of a <CODE>menu</CODE> object:
    <PRE>
(defun create-menu (parent-window text-color background-color text-font)
   (make-menu
      ;; Create menu graphics context
      :gcontext (CREATE-GCONTEXT :drawable   parent-window
                                 :foreground text-color
                                 :background background-color
                                 :font       text-font)

      ;; Create menu window
      :window    (CREATE-WINDOW
                  :parent            parent-window
                  :class             :input-output
                  :x                 0                     ;temporary value
                  :y                 0                     ;temporary value
                  :width             16                    ;temporary value
                  :height            16                    ;temporary value
                  :border-width 2  
                  :border            text-color
                  :background        background-color
                  :save-under        :on
                  :override-redirect :on                   ;override window mgr when positioning
                  :event-mask        (MAKE-EVENT-MASK :leave-window :exposure))))
        </PRE>
     
    <P>
      <A HREF='4_2_Creating_Windows.html#create-window'><B>create-window</B>
      </A> is one of the most important CLX functions, since it creates and 
      returns a <A HREF='1_6_Data_Types.html#window'><B>window</B></A> 
      object. Several of its options are shown here. The default window class 
      is <B>:input-output</B>, but X provides for <B>:input-only</B> windows, 
      too. Every window must have a parent window, except for a 
      system-defined <I>root window</I>, which represents an entire display 
      screen. The <B>:event-mask</B> keyword value, a CLX <A
       HREF='1_6_Data_Types.html#event-mask'><B>event-mask</B></A> data type, 
      says that an input event will be received for the menu window when the 
      window is exposed and also when the pointer cursor leaves the window. 
      The window border is a pattern-filled or (as in this case) a 
      solid-colored boundary which is maintained automatically by the X 
      server; a client cannot draw in a window&#39;s border, since all 
      graphics requests are relative to the origin (upper-left corner) of the 
      window&#39;s interior and are clipped by the server to this inside 
      region. Turning on the <B>:save-under</B> option is a hint to the X 
      server that, when this window is made visible, it may be more efficient 
      to save the pixels it obscures, rather than require several client 
      programs to refresh their windows when the pop-up menu disappears. This 
      is a way to work around X&#39;s client-managed refresh policy when only 
      a small amount of screen space is needed temporarily.
    <P>
      Why is <B>:override-redirect</B> turned on for the menu window? This is 
      actually a little unusual, because it prevents any window manager 
      client from <I>redirecting</I> the position of the menu when it is 
      popped up. Remember that the window manager represents the user&#39;s 
      policy for controlling the positions of his windows, so this kind of 
      redirection is ordinarily correct. However, in this case, as a favor to 
      the user, the menu avoids redirection in order to pop up the menu at a 
      very specific location; that is, under the pointer cursor.
    <P>
      What about the item subwindows? The <CODE>menu-set-item-list</CODE> 
      function in the following example creates them whenever the menu&#39;s 
      item list is changed. The upper-left x and y coordinates and the width 
      and height are not important yet, because they are computed just before 
      the menu is displayed. This function also calls <A
       HREF='4_2_Creating_Windows.html#create-window'><B>create-window</B></A>
      , demonstrating the equal treatment of parent and children windows in 
      the X window hierarchy.
    <PRE>
(defun menu-set-item-list (menu &#38;rest item-strings)
  ;; Assume the new items will change the menu&#39;s width and height
  (setf (menu-geometry-changed-p menu) t)

  ;; Destroy any existing item windows
  (dolist (item (menu-item-alist menu))
    (DESTROY-WINDOW (first item)))
  
  ;; Add (item-window item-string) elements to item-alist
  (setf (menu-item-alist menu)
        (let (alist)
          (dolist (item item-strings (nreverse alist))
            (push (list (CREATE-WINDOW
                         :parent       (menu-window menu)
                         :x            0           ;temporary value
                         :y            0           ;temporary value
                         :width        16          ;temporary value
                         :height       16          ;temporary value
                         :background   (GCONTEXT-BACKGROUND (menu-gcontext menu))
                         :event-mask   (MAKE-EVENT-MASK :enter-window
                                                        :leave-window
                                                        :button-press
                                                        :button-release))
                        item)
                  alist)))))
        </PRE>
     
    <HR>
    <A HREF='1_3_2_Displaying_the_Menu.html'>Next</A> <A
     HREF='1_3_A_Quick_Tour_of_CLX.html'>Prev</A> <A
     HREF='1_3_A_Quick_Tour_of_CLX.html'>Up</A> 
    <HR>
    <A HREF='Front_matter.html'>&#169; 1988, 1989 Texas Instruments 
    Incorporated</A>
    <BR>
    Conversion to HTML made by <A
     HREF='mailto:gilbert@ma2s2.mathematik.uni-karlsruhe.de' LANG='de'>
    Gilbert Baumann</A>.
    <BR>
    Last build: Tue Dec 16 23:30:42 1997
